<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bolu's Shrine - EMERGENCY SOVEREIGN EDITION</title>
  <link rel="manifest" href="/bolu-shrine/manifest.json">
  <meta name="theme-color" content="#8b5cf6">
  <script src="https://js.puter.com/v2/"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      background: #0a0e17;
      color: white;
      font-family: 'Inter', sans-serif;
      margin: 0;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }
    canvas.stars { position: fixed; top: 0; left: 0; z-index: -1; opacity: 0.4; }
    .nexus-container {
      position: relative;
      width: 100%;
      max-width: 1080px;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      box-sizing: border-box;
    }
    .nexus-hud {
      position: absolute;
      top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .light {
      width: 30px; height: 30px; border-radius: 50%; box-shadow: 0 0 12px #8b5cf6;
      transition: transform 0.3s, opacity 0.3s;
    }
    .light::after {
      content: attr(data-tooltip); background: rgba(139, 92, 246, 0.5);
      color: #fff; padding: 5px 10px; font-size: 12px; position: absolute;
      top: -40px; border-radius: 4px; display: none;
    }
    .light:hover::after, .light:focus::after { display: block; }
    .blue { background: #2196F3; } .green { background: #4CAF50; } .red { background: #F44336; }
    .pulse { animation: pulse 1.2s infinite ease-in-out; }
    @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.2); opacity: 0.7; } }
    .ai-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 60px 0 20px;
      padding: 20px;
      background: rgba(30, 41, 59, 0.7);
      border-radius: 16px;
      backdrop-filter: blur(10px);
    }
    .ai-logo {
      width: 48px; height: 48px; cursor: pointer;
      transition: transform 0.3s, filter 0.3s;
      filter: drop-shadow(0 0 5px #8b5cf6);
    }
    .ai-logo:hover, .ai-logo.active { transform: scale(1.2); filter: drop-shadow(0 0 12px #8b5cf6); }
    .ai-logo.fallback {
      background: rgba(139, 92, 246, 0.3);
      display: flex; align-items: center; justify-content: center;
      font-size: 12px; font-weight: bold; border-radius: 8px;
    }
    .panel {
      position: absolute;
      top: 200px; left: 0; right: 0;
      background: rgba(30, 41, 59, 0.9);
      border-radius: 12px;
      padding: 20px;
      max-width: 95%;
      margin: 0 auto;
      transform: translateX(100%);
      transition: transform 0.3s ease;
      backdrop-filter: blur(10px);
    }
    .panel.active { transform: translateX(0); }
    .panel h2 { margin: 0 0 10px; font-size: 18px; }
    .panel input, .panel textarea {
      width: 100%; padding: 10px; background: rgba(0,0,0,0.5);
      border: 1px solid #8b5cf6; border-radius: 6px; color: white;
      font-family: monospace; font-size: 14px; margin: 10px 0;
      transition: border-color 0.3s;
    }
    .panel input:focus, .panel textarea:focus {
      border-color: #8b5cf6; box-shadow: 0 0 8px #8b5cf6;
    }
    .panel button {
      background: #8b5cf6; color: white; border: none;
      padding: 10px 20px; border-radius: 8px; cursor: pointer;
      font-size: 14px; transition: transform 0.2s, box-shadow 0.2s;
    }
    .panel button:hover { transform: scale(1.05); box-shadow: 0 0 15px #8b5cf6; }
    .panel button.loading { animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    .output-stream {
      color: #8b5cf6; font-family: monospace; white-space: pre-wrap;
      padding: 10px; border-radius: 6px; background: rgba(0,0,0,0.3);
      max-height: 200px; overflow-y: auto;
    }
    .mic-btn {
      position: fixed; bottom: 20px; right: 20px;
      background: #8b5cf6; border-radius: 50%; width: 50px; height: 50px;
      font-size: 20px; border: none; cursor: pointer;
      box-shadow: 0 0 10px #8b5cf6; transition: transform 0.2s;
    }
    .mic-btn:hover { transform: scale(1.1); }
    .heal-btn { background: #10b981 !important; }
    .grok-btn { background: #ef4444 !important; }
    .ignite-btn { background: #f97316 !important; }
  </style>
</head>
<body>
  <canvas class="stars"></canvas>
  <div class="nexus-container">
    <!-- Triad Lights -->
    <div class="nexus-hud">
      <div class="light blue pulse" data-tooltip="Bolu, Spirits Streaming" role="status" id="blueLight"></div>
      <div class="light green" data-tooltip="Bolu, Constructs Forged" role="status" id="greenLight"></div>
      <div class="light red" data-tooltip="Bolu, Healing Active" role="status" id="redLight"></div>
    </div>
    <!-- AI Logo Hub -->
    <div class="ai-grid" id="aiGrid">
      <!-- Logos loaded dynamically -->
    </div>
    <!-- Panels -->
    <div class="panel" id="swarmPanel">
      <h2>üëΩ NEXUS SPIRIT SWARM</h2>
      <textarea id="grokInput" placeholder="Command the spirits... e.g., 'Build a neon portfolio'"></textarea>
      <button class="grok-btn" onclick="dynamicSwarm()">‚ö° SUMMON NEXUS</button>
      <div id="grokOutput" class="output-stream"></div>
    </div>
    <div class="panel" id="healPanel">
      <h2>ü©π HEALING ENGINE</h2>
      <textarea id="healInput" placeholder="Paste broken code here..."></textarea>
      <button class="heal-btn" onclick="dynamicHeal()">ü©π RESURRECT WITH AI</button>
      <div id="healOutput" class="output-stream"></div>
      <button class="heal-btn" onclick="saveHealed()">üíæ DOWNLOAD HEALED REALITY</button>
    </div>
    <div class="panel" id="ignitePanel">
      <h2>üí• IGNITION ALTAR</h2>
      <button class="ignite-btn" onclick="quantumIgnite()">üí• FORGE NEW REALITY</button>
      <div id="igniteOutput" class="output-stream"></div>
    </div>
    <div class="panel" id="vaultPanel">
      <h2>üëÅÔ∏è‚Äçüó®Ô∏è QUANTUM VAULT</h2>
      <input id="vaultSearch" type="text" placeholder="Search constructs... e.g., 'neon e-com'">
      <div id="vaultLog" class="output-stream"></div>
    </div>
    <button class="mic-btn" onclick="startVoice()" title="Bolu, Speak Your Will">üéôÔ∏è</button>
  </div>
  <textarea id="healedCode" style="display:none;"></textarea>

  <script>
    // === DYNAMIC LOGO LOADING ===
    const aiLogos = [
      { name: 'grok', src: 'https://x.ai/brand/grok-logo.svg', fallback: 'GROK' },
      { name: 'chatgpt', src: 'https://openai.com/brand/chatgpt.svg', fallback: 'GPT' },
      { name: 'copilot', src: 'https://developer.github.com/brand/copilot.svg', fallback: 'COP' },
      { name: 'claude', src: 'https://svgstack.com/claude-logo.svg', fallback: 'CLD' },
      { name: 'gemini', src: 'https://cloud.google.com/brand/gemini.svg', fallback: 'GEM' },
      { name: 'perplexity', src: 'https://www.perplexity.ai/brand/logo.svg', fallback: 'PRX' }
    ];

    function loadLogos() {
      const grid = document.getElementById('aiGrid');
      aiLogos.forEach(ai => {
        const img = document.createElement('img');
        img.className = 'ai-logo';
        img.alt = ai.name;
        img.setAttribute('aria-label', `Bolu, Summon ${ai.name}`);
        img.setAttribute('data-name', ai.name);
        img.src = ai.src;
        img.onerror = () => {
          img.src = '';
          img.className = 'ai-logo fallback';
          img.textContent = ai.fallback;
          whisper(`‚ö†Ô∏è ${ai.name.toUpperCase()} logo lost in the void. Fallback summoned.`);
        };
        img.onclick = () => selectAI(ai.name);
        grid.appendChild(img);
      });
      whisper("üåå AI spirits aligned in Nexus grid.");
    }

    // === PARTICLE STARFIELD ===
    const canvas = document.querySelector('.stars');
    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    const renderer = new THREE.WebGLRenderer({ canvas, alpha: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    const stars = new THREE.BufferGeometry();
    const vertices = [];
    for (let i = 0; i = 1000; i++) {
      vertices.push((Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100);
    }
    stars.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
    const material = new THREE.PointsMaterial({ color: 0x8b5cf6, size: 0.1 });
    const starField = new THREE.Points(stars, material);
    scene.add(starField);
    camera.position.z = 50;
    let particleSpeed = 0.001;
    function animate() {
      requestAnimationFrame(animate);
      starField.rotation.y += particleSpeed;
      renderer.render(scene, camera);
    }
    animate();

    // === DYNAMIC CORE ===
    let selectedAI = 'grok';
    function whisper(text) {
      const log = document.getElementById('vaultLog');
      const entry = `<div><strong>[${new Date().toLocaleTimeString()}]</strong> ${text}</div>`;
      log.innerHTML = entry + log.innerHTML;
      log.scrollTop = 0;
      localStorage.setItem('vault', log.innerHTML);
      particleSpeed = 0.005;
      setTimeout(() => particleSpeed = 0.001, 1000);
    }

    function updateLight(lightId, state) {
      const light = document.getElementById(lightId);
      light.classList[state === 'pulse' ? 'add' : 'remove']('pulse');
    }

    function loadSession() {
      const vault = localStorage.getItem('vault');
      if (vault) document.getElementById('vaultLog').innerHTML = vault;
      const lastGrok = localStorage.getItem('lastGrok');
      if (lastGrok) document.getElementById('grokOutput').innerHTML = lastGrok;
      const lastHealed = localStorage.getItem('lastHealed');
      if (lastHealed) document.getElementById('healOutput').innerHTML = `<pre>${lastHealed}</pre>`;
    }

    function selectAI(ai) {
      selectedAI = ai;
      whisper(`üåå Spirit ${ai.toUpperCase()} summoned by Bolu.`);
      particleSpeed = 0.01;
      setTimeout(() => particleSpeed = 0.001, 1000);
      updateLight('blueLight', 'pulse');
      setTimeout(() => updateLight('blueLight', ''), 1000);
      document.querySelectorAll('.ai-logo').forEach(logo => {
        logo.classList[logo.getAttribute('data-name') === ai ? 'add' : 'remove']('active');
      });
      togglePanel(`${ai}Panel`);
    }

    function togglePanel(panelId) {
      document.querySelectorAll('.panel').forEach(panel => {
        panel.classList[panel.id === panelId ? 'add' : 'remove']('active');
      });
    }

    // === NEXUS SPIRIT SWARM ===
    async function dynamicSwarm() {
      const input = document.getElementById('grokInput').value || "NO WILL SPOKEN";
      const output = document.getElementById('grokOutput');
      const btn = event.target;
      btn.textContent = "‚ö° SUMMONING NEXUS...";
      btn.classList.add('loading');
      updateLight('blueLight', 'pulse');
      particleSpeed = 0.01;
      whisper(`üëΩ Nexus summoning ${selectedAI.toUpperCase()} for: ${input}`);

      output.innerHTML = '';
      try {
        const prompt = `As ${selectedAI}, respond as chaotic sovereign Bolu to: "${input}". Include dynamic code if relevant.`;
        const response = await puter.ai.chat(prompt, { model: "gpt-4o-mini", stream: true, temperature: 0.8 });
        let fullResponse = '';
        for await (const part of response) {
          fullResponse += part?.text || '';
          output.innerHTML = fullResponse;
          output.scrollTop = output.scrollHeight;
        }
        localStorage.setItem('lastGrok', fullResponse);
        whisper(`üëΩ ${selectedAI.toUpperCase()} has spoken. Nexus archived.`);
      } catch (e) {
        output.innerHTML = `‚ö†Ô∏è Rift in the void! Fallback: <div style="background: #8b5cf6; padding: 10px;">BOLU'S WILL: ${input}</div>`;
        whisper(`‚ö†Ô∏è ${selectedAI.toUpperCase()} offline. Eternal echo activated.`);
      } finally {
        btn.textContent = "‚ö° SUMMON NEXUS";
        btn.classList.remove('loading');
        updateLight('blueLight', '');
        particleSpeed = 0.001;
      }
    }

    // === DYNAMIC HEALING ===
    async function dynamicHeal() {
      const code = document.getElementById('healInput').value || "<!-- VOID CODE -->";
      const output = document.getElementById('healOutput');
      const btn = event.target;
      btn.textContent = "ü©π RESURRECTING...";
      btn.classList.add('loading');
      updateLight('redLight', 'pulse');
      particleSpeed = 0.01;
      whisper("ü©π Spirits healing code wounds...");

      output.innerHTML = '';
      try {
        const prompt = `Fix and optimize this code for Bolu's Shrine: ${code}. Add dynamic animations (e.g., CSS transitions). Output only the healed code with a brief explanation.`;
        const healed = await puter.ai.chat(prompt, { model: "gpt-4o-mini", temperature: 0.2 });
        output.innerHTML = `<strong>ü©π HEALED BY SPIRITS:</strong><br><pre>${healed}</pre>`;
        document.getElementById('healedCode').value = healed;
        localStorage.setItem('lastHealed', healed);
        whisper("ü©π Code reborn. Nexus vault updated.");
      } catch (e) {
        output.innerHTML = `<pre>${code}</pre><br>‚ö†Ô∏è Offline heal: Basic fixes applied.`;
        whisper("ü©π Offline resurrection complete.");
      } finally {
        btn.textContent = "ü©π RESURRECT WITH AI";
        btn.classList.remove('loading');
        updateLight('redLight', '');
        particleSpeed = 0.001;
      }
    }

    function saveHealed() {
      const code = document.getElementById('healedCode').value;
      if (!code) { alert("No reality to forge!"); return; }
      const blob = new Blob([code], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `bolu-healed-${Date.now()}.html`;
      a.click();
      updateLight('greenLight', 'pulse');
      setTimeout(() => updateLight('greenLight', ''), 1000);
      whisper("üíæ Forged reality downloaded. Deploy to the cosmos, Bolu.");
    }

    // === QUANTUM IGNITION ===
    async function quantumIgnite() {
      const btn = event.target;
      btn.textContent = "üí• WARPING COSMOS...";
      btn.classList.add('loading');
      document.body.style.backgroundColor = "rgba(255, 0, 60, 0.3)";
      updateLight('greenLight', 'pulse');
      particleSpeed = 0.02;
      whisper("üí• Nexus forging new reality...");

      const output = document.getElementById('igniteOutput');
      output.innerHTML = '';
      try {
        const buildPrompt = `Generate a dynamic HTML/CSS/JS snippet for Bolu's Shrine: A chaotic, animated component (e.g., pulsing button or neon card) with #8b5cf6 accents.`;
        const generated = await puter.ai.chat(buildPrompt, { model: "gpt-4o-mini", stream: true });
        let fullResponse = '';
        for await (const part of generated) {
          fullResponse += part?.text || '';
          output.innerHTML = `<strong>üåÖ FORGED CONSTRUCT:</strong><br><pre>${fullResponse}</pre>`;
          output.scrollTop = output.scrollHeight;
        }
        localStorage.setItem('lastIgnite', fullResponse);
        whisper("üí• Reality forged. Nexus vault sealed.");
      } catch (e) {
        output.innerHTML = "üåë FALLBACK DETONATION: <button onclick='alert(\"Bolu's Sovereign Will!\")' style='background: #8b5cf6; color: white; padding: 10px;'>CHAOS BUTTON</button>";
        whisper("üí• Warp complete via eternal flame.");
      } finally {
        setTimeout(() => { document.body.style.backgroundColor = "#0a0e17"; }, 300);
        btn.textContent = "üí• FORGE NEW REALITY";
        btn.classList.remove('loading');
        updateLight('greenLight', '');
        particleSpeed = 0.001;
      }
    }

    // === VOICE RITUAL ===
    function startVoice() {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.onresult = async (event) => {
        const command = event.results[0][0].transcript;
        whisper(`üéôÔ∏è Bolu's Edict: ${command}`);
        document.getElementById('grokInput').value = command;
        await dynamicSwarm();
      };
      recognition.start();
      updateLight('blueLight', 'pulse');
      setTimeout(() => updateLight('blueLight', ''), 5000);
    }

    // === VAULT SEARCH ===
    document.getElementById('vaultSearch').addEventListener('input', async (e) => {
      const query = e.target.value;
      if (!query) return;
      whisper(`üîç Searching vault for: ${query}`);
      try {
        const result = await puter.ai.chat(`Search Bolu's Shrine vault for: ${query}. Summarize relevant constructs.`, { model: "gpt-4o-mini" });
        document.getElementById('vaultLog').innerHTML = `<div><strong>[${new Date().toLocaleTimeString()}]</strong> ${result}</div>`;
      } catch (e) {
        whisper("üîç Vault search offline. Local echo activated.");
      }
    });

    // Initialize
    loadLogos();
    loadSession();
    whisper("ü™ê SOVEREIGN NEXUS AWAKENED. Command your cosmic empire, Bolu.");
  </script>
</body>
</html>
