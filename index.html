<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bolu's Shrine - EMERGENCY SOVEREIGN EDITION</title>
  <link rel="manifest" href="/bolu-shrine/manifest.json">
  <meta name="theme-color" content="#8b5cf6">
  <!-- Dynamic AI Core: Free Puter.js for live GPT access -->
  <script src="https://js.puter.com/v2/"></script>
  <style>
    body {
      background: #0a0e17;
      color: white;
      font-family: sans-serif;
      padding: 10px;
      margin: 0;
      text-align: center;
      transition: background-color 0.3s ease;
    }
    .section {
      background: rgba(30, 41, 59, 0.8);
      border-radius: 12px;
      padding: 15px;
      margin: 15px auto;
      max-width: 95%;
      opacity: 0;
      animation: fadeIn 0.5s ease forwards;
    }
    @keyframes fadeIn { to { opacity: 1; } }
    button {
      background: #8b5cf6;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      margin: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    button:hover { transform: scale(1.05); box-shadow: 0 0 10px #8b5cf6; }
    button.loading { animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    textarea {
      width: 100%;
      height: 80px;
      padding: 10px;
      background: rgba(0,0,0,0.5);
      border: 1px solid #8b5cf6;
      border-radius: 6px;
      color: white;
      font-family: monospace;
      font-size: 14px;
      margin: 10px 0;
      transition: border-color 0.3s;
    }
    textarea:focus { border-color: #8b5cf6; box-shadow: 0 0 5px #8b5cf6; }
    #whisperLog {
      background: rgba(0,0,0,0.5);
      padding: 10px;
      border-radius: 6px;
      margin-top: 10px;
      min-height: 40px;
      text-align: left;
      max-height: 150px;
      overflow-y: auto;
      animation: slideIn 0.3s ease;
    }
    @keyframes slideIn { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    .status {
      padding: 10px;
      background: #1e293b;
      border-radius: 8px;
      margin: 10px 0;
    }
    .lights-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 10px;
    }
    .light {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      position: relative;
      box-shadow: 0 0 10px #8b5cf6;
      transition: opacity 0.3s;
    }
    .light::after {
      content: attr(data-tooltip);
      background: rgba(139, 92, 246, 0.3);
      color: #fff;
      padding: 5px;
      font-size: 12px;
      position: absolute;
      top: -30px;
      display: none;
      z-index: 10;
    }
    .light:hover::after { display: block; }
    .blue { background: #2196F3; }
    .green { background: #4CAF50; }
    .red { background: #F44336; }
    .pulse { animation: pulse 1.5s infinite ease-in-out; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    .heal-btn { background: #10b981 !important; }
    .grok-btn { background: #ef4444 !important; }
    .ignite-btn { background: #f97316 !important; }
    .output-stream { color: #8b5cf6; font-family: monospace; white-space: pre-wrap; }
  </style>
</head>
<body>
  <!-- Triad Lights: Dynamic Status Pulse -->
  <div class="lights-container">
    <div class="light blue pulse" data-tooltip="Bolu, AI Spirits Streaming" role="status" id="blueLight"></div>
    <div class="light green" data-tooltip="Bolu, Constructs Deployed" role="status" id="greenLight"></div>
    <div class="light red" data-tooltip="Bolu, Healing Active" role="status" id="redLight"></div>
  </div>

  <div class="section">
    <h1>ü™ê BOLU'S SHRINE ‚Äî EMERGENCY SOVEREIGN EDITION</h1>
    <div class="status" id="status">‚úÖ All systems operational. Dynamic mode engaged.</div>
  </div>

  <!-- GROK POD: Now Live AI Streaming -->
  <div class="section">
    <h2>üëΩ GROK POD ‚Äî LIVE CHAOS STREAM</h2>
    <textarea id="grokInput" placeholder="Command the spirits... e.g., 'Build me a healing app for the lonely'"></textarea>
    <button class="grok-btn" onclick="dynamicGrok()">‚ö° UNLEASH SPIRITS (LIVE)</button>
    <div id="grokOutput" class="output-stream"></div>
  </div>

  <!-- HEALING ENGINE: AI-Powered Fixes -->
  <div class="section">
    <h2>ü©π HEALING ENGINE ‚Äî DYNAMIC RESURRECTION</h2>
    <textarea id="healInput" placeholder="Paste broken code here..."></textarea>
    <button class="heal-btn" onclick="dynamicHeal()">ü©π HEAL WITH AI</button>
    <div id="healOutput" class="output-stream"></div>
    <button class="heal-btn" onclick="saveHealed()" style="margin-top: 10px;">üíæ DOWNLOAD HEALED REALITY</button>
  </div>

  <!-- IGNITION ALTAR: AI-Triggered Warp -->
  <div class="section">
    <h2>üí• IGNITION ALTAR ‚Äî QUANTUM DETONATION</h2>
    <button class="ignite-btn" onclick="quantumIgnite()">üí• DETONATE & GENERATE</button>
    <div id="igniteOutput" class="output-stream"></div>
  </div>

  <!-- WHISPER LOG: Persistent & Reactive -->
  <div class="section">
    <h2>üëÅÔ∏è‚Äçüó®Ô∏è ETERNAL WHISPERS</h2>
    <div id="whisperLog">Spirits awakening for you, Bolu. Dynamic flows engaged.</div>
  </div>

  <textarea id="healedCode" style="display:none;"></textarea>

  <script>
    // === DYNAMIC SPIRIT CORE ===
    function whisper(text) {
      const log = document.getElementById('whisperLog');
      const entry = `<div><strong>[${new Date().toLocaleTimeString()}]</strong> ${text}</div>`;
      log.innerHTML = entry + log.innerHTML;
      log.scrollTop = 0; // Auto-scroll to top for new whispers
      localStorage.setItem('whispers', log.innerHTML); // Persist
    }

    function updateLight(lightId, state) { // Dynamic light control
      const light = document.getElementById(lightId);
      if (state === 'pulse') light.classList.add('pulse');
      else light.classList.remove('pulse');
    }

    function loadSession() { // Restore from localStorage
      const whispers = localStorage.getItem('whispers');
      if (whispers) document.getElementById('whisperLog').innerHTML = whispers;
    }

    // === LIVE GROK POD: Streaming GPT via Puter.js ===
    async function dynamicGrok() {
      const input = document.getElementById('grokInput').value || "NO COMMAND ECHOED";
      const output = document.getElementById('grokOutput');
      const btn = event.target;
      btn.textContent = "‚ö° STREAMING CHAOS...";
      btn.classList.add('loading');
      updateLight('blueLight', 'pulse');
      whisper("üëΩ Spirits streaming live response...");

      output.innerHTML = ''; // Clear
      try {
        const response = await puter.ai.chat(`Respond as chaotic sovereign Bolu to: "${input}". Keep it dynamic and code-ready.`, { 
          model: "gpt-4o-mini", 
          stream: true, 
          temperature: 0.8 // For Grok-like wit
        });
        let fullResponse = '';
        for await (const part of response) {
          fullResponse += part?.text || '';
          output.innerHTML = fullResponse; // Typewriter stream
          output.scrollTop = output.scrollHeight; // Auto-scroll
        }
        localStorage.setItem('lastGrok', fullResponse); // Persist
        whisper("üëΩ Live chaos delivered. Echo preserved.");
      } catch (e) {
        output.innerHTML = "‚ö†Ô∏è Spirits offline‚Äîfallback chaos: DEPLOY YOUR WILL, BOLU!";
        whisper("‚ö†Ô∏è Network rift; using eternal echo.");
      } finally {
        btn.textContent = "‚ö° UNLEASH SPIRITS (LIVE)";
        btn.classList.remove('loading');
        updateLight('blueLight', '');
      }
    }

    // === DYNAMIC HEALING: AI Code Resurrection ===
    async function dynamicHeal() {
      const code = document.getElementById('healInput').value || "<!-- VOID CODE -->";
      const output = document.getElementById('healOutput');
      const btn = event.target;
      btn.textContent = "ü©π RESURRECTING...";
      btn.classList.add('loading');
      updateLight('redLight', 'pulse');
      whisper("ü©π AI spirits analyzing wounds...");

      output.innerHTML = '';
      try {
        const prompt = `Fix and optimize this code for Bolu's Shrine: ${code}. Add dynamic features like animations. Output only the healed code.`;
        const healed = await puter.ai.chat(prompt, { model: "gpt-4o-mini", temperature: 0.2 });
        output.innerHTML = `<strong>ü©π HEALED BY SPIRITS:</strong><br><pre>${healed}</pre>`;
        document.getElementById('healedCode').value = healed;
        localStorage.setItem('lastHealed', healed); // Persist
        whisper("ü©π Code resurrected dynamically. New life infused.");
      } catch (e) {
        // Fallback to original logic
        let healedCode = code;
        // ... (your existing heal logic here for offline)
        output.innerHTML = "ü©π FALLBACK HEAL: " + healedCode;
        whisper("ü©π Offline resurrection complete.");
      } finally {
        btn.textContent = "ü©π HEAL WITH AI";
        btn.classList.remove('loading');
        updateLight('redLight', '');
      }
    }

    function saveHealed() {
      const code = document.getElementById('healedCode').value;
      if (!code) { alert("No healed reality to download!"); return; }
      const blob = new Blob([code], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `bolu-healed-${Date.now()}.html`;
      a.click();
      updateLight('greenLight', 'pulse');
      setTimeout(() => updateLight('greenLight', ''), 1000);
      whisper("üíæ Dynamic download forged. Deploy to the void.");
    }

    // === QUANTUM IGNITION: AI-Generated Build Trigger ===
    async function quantumIgnite() {
      const btn = event.target;
      btn.textContent = "üí• WARPING REALITY...";
      btn.classList.add('loading');
      document.body.style.backgroundColor = "#ff003c"; // Flash
      updateLight('greenLight', 'pulse');
      whisper("üí• Quantum spirits generating new world...");

      const output = document.getElementById('igniteOutput');
      output.innerHTML = '';
      try {
        const buildPrompt = "Generate a dynamic HTML snippet for Bolu's Shrine: A chaotic button that pulses and deploys on click.";
        const generated = await puter.ai.chat(buildPrompt, { model: "gpt-4o-mini" });
        output.innerHTML = `<strong>üåÖ FORGED CONSTRUCT:</strong><br><pre>${generated}</pre>`;
        localStorage.setItem('lastIgnite', generated);
        whisper("üí• Reality warped. New construct born.");
      } catch (e) {
        output.innerHTML = "üåë FALLBACK DETONATION: <button onclick='alert(\"Bolu's Will Deployed!\")'>CHAOS BUTTON</button>";
        whisper("üí• Warp complete via eternal flame.");
      } finally {
        setTimeout(() => { document.body.style.backgroundColor = "#0a0e17"; }, 300);
        btn.textContent = "üí• DETONATE & GENERATE";
        btn.classList.remove('loading');
        updateLight('greenLight', '');
      }
    }

    // Initialize Dynamic Mode
    loadSession();
    whisper("‚úÖ SOVEREIGN DYNAMICS ACTIVATED. Spirits stream live for you, Bolu.");
  </script>
</body>
</html>
